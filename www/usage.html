<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Usage - lobSTR</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="refresh" content="600"> 

<link rel='stylesheet' href='http://cdn1.editmysite.com/editor/images/common/common-v2.css?22' type='text/css' />
<link rel='stylesheet' type='text/css' href='files/main_style.css?1332804341' title='wsite-theme-css' />
<style type='text/css'>
#wsite-content div.paragraph, #wsite-content p, #wsite-content .product-description, .blog-sidebar div.paragraph, .blog-sidebar p, .wsite-form-field label, .wsite-form-field label {}
#wsite-content h2, #wsite-content .product-title, .blog-sidebar h2{}
#wsite-title{font-size:40px !important;}
</style>
<script type='text/javascript'><!--
var STATIC_BASE = 'http://cdn1.editmysite.com/';
var STYLE_PREFIX = 'wsite';
//-->
</script>
<script type='text/javascript' src='http://cdn1.editmysite.com/libraries/prototype/1.7-custom/prototype.min.js'></script>
<script type='text/javascript' src='http://cdn1.editmysite.com/libraries/scriptaculous/1.9.0-custom/effects.min.js'></script>
<script type='text/javascript' src='http://cdn1.editmysite.com/editor/images/common/utilities.js?17'></script>
<script type='text/javascript' src='http://cdn1.editmysite.com/editor/images/common/lightbox202.js?110'></script>
<script type='text/javascript' src='http://cdn1.editmysite.com/editor/libraries/flyout_menus.js?13'></script>
<script type='text/javascript'><!--
var IS_ARCHIVE=1;
function initFlyouts(){initPublishedFlyoutMenus([{"id":"155159388479881257","title":"Home","url":"index.html"},{"id":"482706786380939227","title":"Download","url":"download.html"},{"id":"911862752701740992","title":"Install","url":"install.html"},{"id":"705726613435707897","title":"Usage","url":"usage.html"},{"id":"495479748563597039","title":"File formats","url":"file-formats.html"},{"id":"262602591113460083","title":"News","url":"news.html"},{"id":"359371236662353445","title":"FAQ","url":"faq.html"},{"id":"854238589279126447","title":"Contact Us","url":"contact-us.html"}],'705726613435707897',"<li class='wsite-nav-more'><a href='#'>more...<\/a><\/li>",'active',false)}
if (Prototype.Browser.IE) window.onload=initFlyouts; else document.observe('dom:loaded', initFlyouts);
//-->
</script>
</head>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-30530333-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-30530333-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<body class='wsite-theme-light wsite-page-usage'>
<div id="header-wrap"><div id="header-content">

		<h1 id="logo"><span class='wsite-logo'><a href='index.html'><img src='uploads/1/1/4/4/11449783/1332803980.png' style='margin-top:-2px;margin-left:-17px;max-height:67px;' /></a></span></h1>

		<ul><li id='pg155159388479881257'><a href='index.html'>Home</a></li><li id='pg482706786380939227'><a href='download.html'>Download</a></li><li id='pg911862752701740992'><a href='install.html'>Install</a></li><li id='active'><a href='usage.html'>Usage</a></li><li id='pg495479748563597039'><a href='file-formats.html'>Formats</a></li><li id='pg262602591113460083'><a href='news.html'>News</a></li><li id='pg359371236662353445'><a href='faq.html'>FAQ</a></li><li id='pg854238589279126447'><a href='contact-us.html'>Contact Us</a></li><li id='pg359371236662353999'><a href='documentation.html'>Docs</a></li></ul>

	</div></div>

	<!-- content-wrap starts here -->
	<div id="content-wrap"><div id="content">

	<div id="main">

	<div id='wsite-content' class='wsite-not-footer'>
<div class='wsite-not-footer'>
<h2  style=" text-align: left; ">You will need</h2>
<div  class="paragraph editable-text" style=" text-align: left;
					     display: block;
					     ">
<ul style="">
<li style="">Download
      the&nbsp;<a href="download.html" style=""
		  title="">lobSTR</a>&nbsp;package.</li>
<li style="">Download
      the lobSTR resource bundle for the appropriate reference genome (available on
      the<a href="download.html">&nbsp;downloads</a>&nbsp;page).</li>
<li style="">Many details can be found in the <a href="lobSTR_manual_v2.0.pdf">lobSTR 2.0 manual</a>. The manual currently contains usage information for lobSTR v2.0.0. Usage is slightly different for later versions, but most parameters are the same. This document will be updated to reflect later versions.</li>
</ul></div>

<h2  style=" text-align: left; ">On this page</h2>
<div  class="paragraph editable-text" style=" text-align: left;
					     display: block; ">
<ul style=""><li style="">Basic usage</li><li style="">Building a
    custom index</li>
<li style="">Detailed description of all command line options</li></ul></div>

<h2  style=" text-align: left; ">Basic usage (v2.0.3)<br /></h2>
<div  class="paragraph editable-text" style=" text-align: left;
					     display: block; ">
<b>To run lobSTR using default parameters</b>:
<br>Single-end reads:
<br /><tt><verbatim>&nbsp;lobSTR -f FILE1,FILE2,.. --index-prefix PATH_TO_INDEX/lobSTR_   -o OUTPUT_PREFIX   </tt></verbatim><br>
<br>Paired-end reads:
<br /><tt>&nbsp;lobSTR --p1 FILE1,FILE2,.. --p2 FILE1,FILE2,...	  --index-prefix PATH_TO_INDEX/lobSTR_ 	    -o OUTPUT_PREFIX  	    </tt><br>
<br>
<tt>samtools sort OUTPUT_PREFIX.aligned.bam OUTPUT_PREFIX.sorted</tt><br>
<tt>samtools index OUTPUT_PREFIX.sorted.bam</tt><br>
<tt>allelotype 	    --command [train|classify|both|simple] 	    --bam OUTPUT_PREFIX.sorted.bam 	    [--noise_model NOISEMODELPREFIX] 	    --out OUTPUT_PREFIX 	--strinfo STRINFOFILE --index-prefix PATH_TO_INDEX/lobSTR_ </tt> <br />
<br />
<b>To run an example using files available in the download</b>:
<br />&nbsp;<tt>lobSTR 	    --p1 PATH_TO_LOBSTR/tests/mp_1.fq --p2
  PATH_TO_LOBSTR/tests/tmp_2.fq -q 	    --index-prefix PATH_TO_INDEX/lobSTR_ 	    -o test  --rg-sample mysample	    </tt>
<br><br>
<tt>samtools sort test.aligned.bam test.sorted</tt><br>
<tt>samtools index test.sorted.bam</tt>
<br><br>
<tt>allelotype 	    --command classify 	    --bam test.sorted.bam 	    --noise_model 	      PATH_TO_LOBSTR/models/illumina_v2.0.3 	    --out test --strinfo strinfo.hg19.tab	--index-prefix PATH_TO_INDEX/lobSTR_	</tt>    <br /><br />

Note the index and str info files are available in the resource bundle. 

This will create the example output files:
<ul style="">
<li style="">test.aligned.tab</li>
<li style="">test.aligned.bam</li>
<li style="">test.vcf</li>
</ul>
To see a description of the output file formats, see<a href="file-formats.html" title="">&nbsp;file formats</a>. To see all available parameters, run&nbsp;<tt>lobSTR --help</tt>&nbsp;and&nbsp;<tt>allelotype --help</tt>.<br /></div>

<h2  style=" text-align: left; ">Building a custom index<br /></h2>
<div  class="paragraph editable-text" style=" text-align: left; display: block; ">lobSTR provides an index in hg18 or hg19 coordinates available on the&nbsp;<a href="download.html">downloads</a>&nbsp;page. These indices were created using the STR coordinates also available for download there. You may wish to create a custom index with a different set of STR loci. To do so you will need:
<ul style="">
<li style="">STR_TABLE: A bed file containing a list of STR coordinates, in the format output from the Tandem Repeat Finder. The columns must match those in trf.ucsc.hg18.filtered.bed. In particular, the following columns must be present:
<ol style="">
<li style="">Column 1: chromosome</li>
<li style="">Column 2: start coordinate of the STR</li>
<li style="">Column 3: end coordinate of the STR</li>
<li style="">Column 4: period of the STR</li>
<li style="">Column 5: reference copy number</li>
<li style="">Column 9: STR score. This score measures the purity of the STR sequence and is based on the suggested <a href="http://tandem.bu.edu/trf/trf.unix.help.html">Tandem Repeats Finder scoring scheme</a> with match=2, mismatch=-7 and indel=-7. Therefore the maximum possible score for a perfectly pure STR sequence (e.g. ATATATATATAT) is 2*(length of STR region).
<li style="">Column 15: STR repeat unit</li></ol>
</li>
<li style="">REF_GENOME.fa: A reference genome in fasta format for *the same genome build* as the bed file of STR coordinates.</li>
<li style="">OUT_DIR: the directory to store the index. Note this will overwrite any existing indices in this directory.</li></ul>To build a new index, run:	    python PATH_TO_LOBSTR/scripts/lobstr_index.py 	    --str STR_TABLE --ref REF_GENOME.fa --out OUT_DIR 	    <br /><br />This will create an index with the prefix OUT_DIR/lobSTR_<br />
<br>
***If using a custom index, you will also need to generate a file with information on each STR locus to input to the <tt>--strinfo</tt> option of the allelotyper. The lobSTR download provides the script <tt>GetSTRInfo.py</tt> to do so ***.

<br><br>
General usage:
<br>
<tt>python $PATH_TO_LOBSTR/scripts/GetSTRInfo.py $STR_TABLE $REF.fa > $STRINFOFILE</tt>
<br><br>
where $STR_TABLE as described above, $REF.fa is the reference genome in fasta format, and $STRINFOFILE is where you would like to write the strinfo file.<br><br>
Example:
<tt>python $PATH_TO_LOBSTR/scripts/GetSTRInfo.py reference.bed hg19.fa > strinfo.reference.tab</tt>
</div>

<h2  style=" text-align: left; ">Detailed description of command line options<br /></h2>
<div  class="paragraph editable-text" style=" text-align: left;
					     display: block;">
<h3>lobSTR</h3>
<h4>General</h4>
<ul style="">
<li style="">-f, --files FILES: file or comma-separated list of single
  ends in fasta, fastq, or bam
  files to align (default: fasta). Also use this parameter to specify
  paired-end bam files to align. Note, paired end bam files must be
  sorted by read identifier before running lobSTR</li>
<li style="">--p1 FILES: file or comma-separated list of files
	    containing the first end of paired end reads in fasta
	     or fastq format (default: fasta)</li>
<li style="">--p2 FILES: file or comma-separated list of files
	    containing the second end of paired end reads in fasta
	     or fastq format (default: fasta)</li>
<li style="">-o STRING: prefix to name output files with (required)</li>
<li style="">--index-prefix STRING: prefix of the path to the lobSTR
	     index. If the index is stored in DIR, then this should
	     be set to DIR/lobSTR_ (required)</li>
<li style="">-q: the input files are in fastq
  format</li>
<li style="">--bam: the input files are in bam format</li>
<li style="">--bampair: the input bam files are paired-end. Note: bam
	    files MUST be sorted by read name (samtools sort -n
	    file.bam prefix)</li>
<li style="">--gzip: the input files are gzipped (only works for fasta
	    or fastq input)</li>
<li style="">--bwaq INT: trim reads based on quality score. Same as
	     the -q parameter in BWA.</li>
<li style="">--oldillumina: specifies that base pair quality scores
	     are reported in the old Phred format (Illumina 1.3+,
	     Illumina 1.5+) where quality scores are given as Phred
	     + 64 rather than Phred + 33</li>
<li style="">--rg-sample STRING: Use this in the read group SM tag. <b>Allelotype will assume all reads with the same sample should be processed as a single individual.</b></li
<li style="">--rg-lib STRING: Use this in the read group LB tag</li>
<li style="">-h, --help: display a helpful usage message</li>
<li style="">-v, --verbose: verbose mode. Display descriptive messages</li>
<li style="">--version: print out lobSTR program version</li>
<li style="">--noweb: Do not report any user information to Amazon S3.</li></ul>
</ul>
<h4>Advanced options - general</h4>
<ul style="">
<li style="">-p INT: number of threads to
  use</li>
<li style="">--min-read-length INT: the minimum read length
		       to attempt to align (default: 45)</li>
<li style="">--max-read-length INT:
  the maximum read length to attempt to align (default: 1024)</li>
</ul>
<h4>Advanced options - detection</h4>
<ul style="">
<li style="">--fft-window-size INT: the size of the sliding window to
	     detect repetitive regions of a read (default: 16)</li>
<li style="">--fft-window-step INT: the step
  size of the sliding window (default: 4)</li>
<li style="">--entropy-threshold FLOAT: the percentage of the maximum
	     entropy score required for detection (default:
	     0.45)</li>
<li style="">--minperiod INT: The minimum period to detect (default: 1)</li>
<li style="">--maxperiod INT: The maximum period to detect (default: 6)</li>
<li style="">--minflank INT: The minimum flanking region length for alignment (default: 8)</li>
<li style="">--maxflank INT: Trim flanking regions to this length
	     before alignment. This is useful when aligning long
	     reads more than 100-200bp (default: 50)</li>
</ul>
<h4>Advanced options - alignment</h4>
<ul style="">
<li style="">--max-diff-ref INT: Only report reads differing by at
	     most this number of bp from the reference allele
	     (default: 50)</li>
<li style="">--extend INT: Number of bp the reference was extended
                           when building the index (default: 1000bp).
                           Must be same as --extend parameter used
                           to run lobstr_index.py </li>
<li style="">--mapq INT    maximum allowed mapq score (default: 75)
                           calculated as the sum of qualities at base
                           mismatches. </li>
<li style="">-u: only report reads different by an integer number of
  copy numbers from the reference allele</li>
<li style="">-m INT: allowed edit distance in either flanking region
  (default: -1)</li>
<li style="">-r FLOAT: the fraction of missing alignments given 2%
  uniform base error rate. Ignored if -m is set (default:
  0.01)</li><li style="">-g INT: the number of gap opens allowed
  (default: 1)</li>
<li style="">-e INT: the number of gap extends allowed (default:
  1)</li>
</ul>
<h4>Advanced options - Amazon Web Services</h4>
<ul style="">
<li style="">--use-s3 BUCKET:        Files are read from this s3 bucket.
                           WARNING s3 mode DELETES FILES after processing
                           DO NOT USE this option unless you are pulling
                           files from Amazon S3! </li>
<li style="">--s3config FILE:   s3cmd configuration file (created by
                           s3cmd --configure)</li>
</ul>

<h3>allelotype</h3>
<h4>General</h4>
<ul style=""><li style="">--command: (required) one of the following:
<ul style="">
<li style="">train: train the noise model based on the provided bam
  alignment. This only works on male samples with a large number of
  reads aligned to sex chromosome STRs. It is currently recommended
  that you use the provided stutter model file. 
  Training outputs the files:
  <ul>
    <li>$noisemodelprefix.stepmodel</li>
    <li>$noisemodelprefix.stuttermodel</li>
    <li>$noisemodelprefix.stutterproblem</li>
    </ul>
</li>
<li style="">classify:
  generate allelotypes from the provided alignment file and using the
  provided noise model.
  Classifying outputs the files:
  <ul>
    <li>$output_prefix.vcf</li>
    <li>$output_prefix.genotypes.tab</li>
    </ul>
</li>
</ul>
Note, the commands "simple" and "both" have been removed. 
</li>
<li style="">--bam FILE: (REQUIRED) path to the bam file containing alignments,
	     or a comma separated list of multiple lobSTR bam alignments (required). </li>
<li style="">--noise_model STRING: (REQUIRED) prefix of files to write (--command train) or read (--command classify) noise model parameters to.</li>
<li style="">--out STRING: (REQUIRED) prefix to name output files with (required)</li>
<li style="">--strinfo STRING: (REQUIRED) path to the file containing statistics for each STR, available in the lobSTR resource bundle.
<li style="">--index-prefix STRING: (REQUIRED for --command classify) prefix for lobSTR's bwa reference (must run lobstr_index.py)
<li style="">--haploid LIST: comma separated list of chromosomes to treat as haploid (e.g. --haploid chrX,chrY) for a human male sample. If all chromosomes are haploid, you can specifiy --haploid all.</li>
<li style="">--annotation VCFFILE: annotate a set of STRs. Annotation sets are available in the resource bundle. This is useful for comparing to capillary callsets such as those from the Marshfield panel. More documentation on this option is coming soon.</li>
<li style="">--min-het-freq FLOAT: minimum alternate allele read frequency to make a heterozygous call
<li style="">--include-flank: include indels in the flanking regions of an STR when determining the length of the STR allele </li>
<li style="">--no-rmdup: do not remove PCR duplicates. <b>Note for multi-sample calling, use this option. lobSTR does not yet implement removing duplicates in a sample-aware way.</b></li>
<li style="">--help, -h: print a helpful usage message</li>
<li style="">-v, --verbose: verbose mode, print out descriptive messages</li>
<li style="">--version: print out allelotype program version number</li>
<li style="">--noweb: do not report any user information and parameters to Amazon S3.</li>
</ul>
<h4>Advanced options - filtering reads</h4>
<ul>
<li style="">--chrom STRING: only look at reads from this chromosome.
<li style="">--max-diff-ref INT: filter reads differing from the reference allele by more than INT bp</li>
<li style="">--unit: filter reads differing from the reference by a non-integer number of repeat copies</li>
<li style="">--mapq INT: filter reads with mapq scores of more than INT</li>
<li style="">--max-matedist INT: filter reads with a mate distance larger than INT bp</li>
</ul>
<h4>Examples of allelotype usage</h4>
<br>
To train the genotyping noise model from a set of aligned reads:
<br><tt>
allelotype --command train [OPTIONS] --bam input.bam
    --noise_model noisemodelprefix --haploid chrX,chrY
    --strinfo strinfofile
</tt>
<br><br>
To run str profiling on a set of aligned reads:
<br><tt>
allelotype --command classify [OPTIONS] --bam input.bam
      --noise_model noisemodelprefix [--no-rmdup]
	--out output_prefix --strinfo strinfofile --index-prefix PATH_TO_INDEX/lobSTR_
</tt>
<br><br>


<h3>lobstr_index.py</h3>
<ul style="">
<li style="">--str FILE: A bed file containing a list of STR loci
	     output from Tandem Repeat Finder. This file does not
	     necessarily need to be created by TRF. The necessary
	     columns are described above</li>
<li style="">--ref FILE: A fasta file containing the reference genome</li>
<li style="">--out_dir DIR: the directory to store the index created</li>
<li style="">-h, --help: display a helpful usage message</li>
<li style="">-v, --verbose: verbose mode, display descriptive output</li>
<li style="">--extend INT: The number of base pairs to include
	     flanking either region of the STR. This should be at
	     least as long as the read length you intend to
	     align. IMPORTANT: if you change the extend parameter
	     here, you MUST remember to set the --extend paramter to
  the same value when you call lobSTR to ensure that the output
  coordinates are accurate (default 1000bp).</li></ul>

</div>

</div>
</div>


	</div>

	<!-- content-wrap ends here -->
	</div></div>

	<!-- footer starts here -->
	<div id="footer-wrap"><div id="footer-content">

		<div class="col float-left space-sep">
			<p>
			<span id='weeblyFooter'>Create a <a target="_top" href="http://www.weebly.com/">free web site</a> with <a target="_top" href="http://www.weebly.com/" title="free web site">Weebly</a></span>
			</p>
		</div>
		<br class="clear" />

	</div></div>
	<!-- footer ends here -->


</body>
</html>
